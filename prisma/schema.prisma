// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Session storage model
model Session {
  sid    String   @id @db.VarChar
  sess   Json     @db.Json
  expire DateTime @db.Timestamp(6)

  @@index([expire], map: "IDX_session_expire")
  @@map("sessions")
}

// User model
model User {
  id              String   @id @db.VarChar
  email           String?  @unique @db.VarChar
  username        String?  @unique @db.VarChar
  firstName       String?  @db.VarChar
  lastName        String?  @db.VarChar
  profileImageUrl String?  @db.VarChar
  password        String?  @db.VarChar
  role            String   @default("user") @db.VarChar
  permissions     String[] @db.Text
  walletCredits   Int      @default(0)
  listingLimit    Int      @default(10)
  isActive        Boolean  @default(true)
  isVerified      Boolean  @default(false)
  creditBalance   Decimal  @default(0) @db.Decimal(12, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  products            Product[]
  reviews             Review[]
  cartItems           CartItem[]
  wishlistItems       WishlistItem[]
  orders              Order[]
  chatRoomsAsCustomer ChatRoom[]        @relation("CustomerChatRooms")
  chatRoomsAsAgent    ChatRoom[]        @relation("AgentChatRooms")
  chatMessages        ChatMessage[]
  properties          Property[]
  guestBookings       Booking[]         @relation("GuestBookings")
  propertyReviews     PropertyReview[]
  payments            Payment[]
  itineraries         Itinerary[]
  preferences         UserPreferences?
  interactions        UserInteraction[]
  recommendations     Recommendation[]
  contentRatings      ContentRating[]
  affiliate           Affiliate?
  notifications       Notification[]
  tours               TourDetail[]
  tourBookings        TourBooking[]
  shippingAddresses   ShippingAddress[]
  phones              UserPhone[]
  recentlyViewed      RecentlyViewedProduct[]
  savedProducts       SavedProduct[]
  creditTransactions  CreditTransaction[]

  @@map("users")
}

// Category model
model Category {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  slug        String   @unique @db.VarChar(100)
  description String?  @db.Text
  parentId    Int?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  products Product[]

  @@map("categories")
}

// Product model
model Product {
  id               Int      @id @default(autoincrement())
  sellerId         String   @db.VarChar
  title            String   @db.VarChar(200)
  description      String?  @db.Text
  price            Decimal  @db.Decimal(10, 2)
  categoryId       Int
  stock            Int      @default(0)
  images           String[] @db.Text
  isActive         Boolean  @default(true)
  boostScore       Int      @default(0)
  boostedAt        DateTime?
  customAttributes Json     @default("{}") @db.Json
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  seller         User                    @relation(fields: [sellerId], references: [id])
  category       Category                @relation(fields: [categoryId], references: [id])
  reviews        Review[]
  cartItems      CartItem[]
  wishlistItems  WishlistItem[]
  orderItems     OrderItem[]
  discounts      Discount[]
  recentlyViewed RecentlyViewedProduct[]
  savedBy        SavedProduct[]

  @@map("products")
}

// Review model
model Review {
  id        Int      @id @default(autoincrement())
  userId    String   @db.VarChar
  productId Int
  rating    Int
  comment   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@map("reviews")
}

// Generic content rating model to support products, hosts, tours, trips, and more
model ContentRating {
  id         Int      @id @default(autoincrement())
  userId     String   @db.VarChar
  targetType String   @db.VarChar(50)
  targetId   String   @db.VarChar
  rating     Int
  comment    String?  @db.Text
  metadata   Json?    @db.Json
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  user User @relation(fields: [userId], references: [id])

  @@unique([userId, targetType, targetId])
  @@index([targetType, targetId])
  @@map("content_ratings")
}

// Cart Item model
model CartItem {
  id        Int      @id @default(autoincrement())
  userId    String   @db.VarChar
  productId Int
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@map("cart_items")
}

// Wishlist Item model
model WishlistItem {
  id        Int      @id @default(autoincrement())
  userId    String   @db.VarChar
  productId Int
  createdAt DateTime @default(now())

  // Relations
  user    User    @relation(fields: [userId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@map("wishlist_items")
}

// Order model
model Order {
  id              Int      @id @default(autoincrement())
  userId          String   @db.VarChar
  status          String   @default("pending") @db.VarChar(20)
  totalAmount     Decimal  @db.Decimal(10, 2)
  discountAmount  Decimal  @default(0) @db.Decimal(10, 2)
  discountId      Int?
  shippingAddress Json?    @db.Json
  paymentMethod   String?  @db.VarChar(50)
  paymentStatus   String?  @default("pending") @db.VarChar(20)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  user       User        @relation(fields: [userId], references: [id])
  orderItems OrderItem[]
  discount   Discount?   @relation(fields: [discountId], references: [id])

  @@map("orders")
}

// Order Item model
model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int
  productId Int
  quantity  Int
  price     Decimal @db.Decimal(10, 2)

  // Relations
  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])

  @@map("order_items")
}

// Chat Room model
model ChatRoom {
  id             Int       @id @default(autoincrement())
  customerId     String    @db.VarChar
  supportAgentId String?   @db.VarChar
  status         String    @default("active") @db.VarChar(20)
  subject        String?   @db.VarChar(255)
  priority       String    @default("medium") @db.VarChar(20)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  closedAt       DateTime?

  // Relations
  customer     User          @relation("CustomerChatRooms", fields: [customerId], references: [id])
  supportAgent User?         @relation("AgentChatRooms", fields: [supportAgentId], references: [id])
  messages     ChatMessage[]

  @@map("chat_rooms")
}

// Chat Message model
model ChatMessage {
  id          Int      @id @default(autoincrement())
  roomId      Int
  senderId    String   @db.VarChar
  message     String   @db.Text
  messageType String   @default("text") @db.VarChar(20)
  isRead      Boolean  @default(false)
  createdAt   DateTime @default(now())

  // Relations
  room   ChatRoom @relation(fields: [roomId], references: [id])
  sender User     @relation(fields: [senderId], references: [id])

  @@map("chat_messages")
}

// Property model
model Property {
  id               Int      @id @default(autoincrement())
  hostId           String   @db.VarChar
  title            String   @db.VarChar(200)
  description      String?  @db.Text
  propertyType     String   @db.VarChar(50)
  roomType         String   @db.VarChar(50)
  maxGuests        Int
  bedrooms         Int      @default(1)
  bathrooms        Int      @default(1)
  pricePerNight    Decimal  @db.Decimal(10, 2)
  cleaningFee      Decimal  @default(0) @db.Decimal(10, 2)
  serviceFee       Decimal  @default(0) @db.Decimal(10, 2)
  address          String   @db.Text
  city             String   @db.VarChar(100)
  state            String?  @db.VarChar(100)
  country          String   @db.VarChar(100)
  zipCode          String?  @db.VarChar(20)
  latitude         Decimal? @db.Decimal(10, 8)
  longitude        Decimal? @db.Decimal(11, 8)
  images           String[] @db.Text
  amenities        String[] @db.Text
  isActive         Boolean  @default(true)
  instantBook      Boolean  @default(false)
  customAttributes Json     @default("{}") @db.Json
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  host             User                   @relation(fields: [hostId], references: [id])
  bookings         Booking[]
  reviews          PropertyReview[]
  availability     PropertyAvailability[]
  roomAvailability RoomAvailability[]
  discounts        Discount[]

  @@map("properties")
}

// Booking model
model Booking {
  id              Int      @id @default(autoincrement())
  propertyId      Int
  guestId         String   @db.VarChar
  checkIn         DateTime @db.Date
  checkOut        DateTime @db.Date
  guests          Int
  totalAmount     Decimal  @db.Decimal(10, 2)
  discountAmount  Decimal  @default(0) @db.Decimal(10, 2)
  discountId      Int?
  status          String   @default("pending") @db.VarChar(20)
  specialRequests String?  @db.Text
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  // Relations
  property Property        @relation(fields: [propertyId], references: [id])
  guest    User            @relation("GuestBookings", fields: [guestId], references: [id])
  review   PropertyReview?
  discount Discount?       @relation(fields: [discountId], references: [id])

  @@map("bookings")
}

// Property Review model
model PropertyReview {
  id            Int      @id @default(autoincrement())
  propertyId    Int
  bookingId     Int      @unique
  userId        String   @db.VarChar
  rating        Int
  cleanliness   Int?
  communication Int?
  checkIn       Int?
  accuracy      Int?
  location      Int?
  value         Int?
  comment       String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  property Property @relation(fields: [propertyId], references: [id])
  booking  Booking  @relation(fields: [bookingId], references: [id])
  user     User     @relation(fields: [userId], references: [id])

  @@map("property_reviews")
}

// Property Availability model
model PropertyAvailability {
  id          Int      @id @default(autoincrement())
  propertyId  Int
  date        DateTime @db.Date
  available   Boolean  @default(true)
  customPrice Decimal? @db.Decimal(10, 2)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  property Property @relation(fields: [propertyId], references: [id])

  @@unique([propertyId, date])
  @@map("property_availability")
}

// Room Availability model
model RoomAvailability {
  id             Int      @id @default(autoincrement())
  propertyId     Int
  date           DateTime @db.Date
  availableRooms Int      @default(0)
  totalRooms     Int      @default(1)
  priceOverride  Decimal? @db.Decimal(10, 2)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  property Property @relation(fields: [propertyId], references: [id])

  @@unique([propertyId, date])
  @@map("room_availability")
}

// Payment model
model Payment {
  id            Int      @id @default(autoincrement())
  userId        String   @db.VarChar
  bookingId     Int?
  amount        Decimal  @db.Decimal(10, 2)
  currency      String   @default("VND") @db.VarChar(3)
  status        String   @default("pending") @db.VarChar(20)
  paymentMethod String   @db.VarChar(50)
  transactionId String?  @db.VarChar(100)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@map("payments")
}

// Itinerary model
model Itinerary {
  id          Int      @id @default(autoincrement())
  userId      String   @db.VarChar
  title       String   @db.VarChar(200)
  description String?  @db.Text
  destination String   @db.VarChar(100)
  startDate   DateTime @db.Date
  endDate     DateTime @db.Date
  totalBudget Decimal? @db.Decimal(10, 2)
  status      String   @default("planning") @db.VarChar(20)
  isPublic    Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user User           @relation(fields: [userId], references: [id])
  days ItineraryDay[]

  @@map("itineraries")
}

// Itinerary Day model
model ItineraryDay {
  id          Int      @id @default(autoincrement())
  itineraryId Int
  dayNumber   Int
  date        DateTime @db.Date
  title       String?  @db.VarChar(200)
  notes       String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  itinerary  Itinerary           @relation(fields: [itineraryId], references: [id])
  activities ItineraryActivity[]

  @@map("itinerary_days")
}

// Itinerary Activity model
model ItineraryActivity {
  id          Int       @id @default(autoincrement())
  dayId       Int
  title       String    @db.VarChar(200)
  description String?   @db.Text
  startTime   DateTime? @db.Time
  endTime     DateTime? @db.Time
  location    String?   @db.VarChar(200)
  cost        Decimal?  @db.Decimal(10, 2)
  category    String?   @db.VarChar(50)
  orderIndex  Int       @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  day ItineraryDay @relation(fields: [dayId], references: [id])

  @@map("itinerary_activities")
}

// User Preferences model for personalized recommendations
model UserPreferences {
  id                    Int      @id @default(autoincrement())
  userId                String   @unique @db.VarChar
  // Travel preferences
  preferredDestinations String[] @db.Text
  travelBudgetRange     String?  @db.VarChar(50)
  travelStyle           String?  @db.VarChar(50)
  accommodationType     String?  @db.VarChar(50)
  // Product preferences
  favoriteCategories    String[] @db.Text
  priceRange            String?  @db.VarChar(50)
  brandPreferences      String[] @db.Text
  // General preferences
  interests             String[] @db.Text
  language              String   @default("vi") @db.VarChar(10)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@map("user_preferences")
}

// User Interactions model for tracking user behavior
model UserInteraction {
  id         Int      @id @default(autoincrement())
  userId     String   @db.VarChar
  itemType   String   @db.VarChar(20) // 'product', 'property', 'destination'
  itemId     String   @db.VarChar
  actionType String   @db.VarChar(20) // 'view', 'like', 'share', 'purchase', 'book'
  duration   Int? // Time spent in seconds
  metadata   Json? // Additional context data
  createdAt  DateTime @default(now())

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@map("user_interactions")
}

// Recommendation model for storing generated recommendations
model Recommendation {
  id        Int       @id @default(autoincrement())
  userId    String    @db.VarChar
  itemType  String    @db.VarChar(20) // 'product', 'property', 'destination'
  itemId    String    @db.VarChar
  score     Decimal   @db.Decimal(5, 4) // Relevance score 0-1
  reason    String?   @db.Text // Why this was recommended
  category  String?   @db.VarChar(50) // Recommendation category
  isActive  Boolean   @default(true)
  clickedAt DateTime?
  createdAt DateTime  @default(now())
  expiresAt DateTime?

  // Relations
  user User @relation(fields: [userId], references: [id])

  @@map("recommendations")
}

// Similar Items model for content-based recommendations
model SimilarItem {
  id            Int      @id @default(autoincrement())
  itemType      String   @db.VarChar(20) // 'product', 'property', 'destination'
  itemId        String   @db.VarChar
  similarItemId String   @db.VarChar
  similarity    Decimal  @db.Decimal(5, 4) // Similarity score 0-1
  createdAt     DateTime @default(now())

  @@unique([itemType, itemId, similarItemId])
  @@map("similar_items")
}

// Tour models
model TourDetail {
  id          Int      @id @default(autoincrement())
  hostId      String   @db.VarChar
  title       String   @db.VarChar(200)
  description String?  @db.Text
  location    String   @db.VarChar(150)
  duration    String?  @db.VarChar(100)
  basePrice   Decimal  @db.Decimal(10, 2)
  tags        String[] @db.Text
  images      String[] @db.Text
  status      String   @default("published") @db.VarChar(30)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  host      User           @relation(fields: [hostId], references: [id])
  schedules TourSchedule[]
  discounts Discount[]

  @@map("tours")
}

model TourSchedule {
  id             Int      @id @default(autoincrement())
  tourId         Int
  startTime      DateTime
  endTime        DateTime
  capacity       Int
  availableSpots Int
  price          Decimal? @db.Decimal(10, 2)
  meetingPoint   String?  @db.VarChar(200)
  notes          String?  @db.Text
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  tour     TourDetail     @relation(fields: [tourId], references: [id])
  tickets  TicketDetail[]
  bookings TourBooking[]

  @@map("tour_schedules")
}

model TicketDetail {
  id             Int      @id @default(autoincrement())
  tourScheduleId Int
  name           String   @db.VarChar(120)
  description    String?  @db.Text
  price          Decimal  @db.Decimal(10, 2)
  perks          String[] @db.Text

  schedule TourSchedule @relation(fields: [tourScheduleId], references: [id])

  @@map("ticket_details")
}

model TourBooking {
  id             Int      @id @default(autoincrement())
  userId         String   @db.VarChar
  tourScheduleId Int
  guests         Int      @default(1)
  status         String   @default("pending") @db.VarChar(30)
  totalAmount    Decimal  @db.Decimal(10, 2)
  discountAmount Decimal  @default(0) @db.Decimal(10, 2)
  discountId     Int?
  contactEmail   String?  @db.VarChar(200)
  contactPhone   String?  @db.VarChar(50)
  bookedAt       DateTime @default(now())

  user     User         @relation(fields: [userId], references: [id])
  schedule TourSchedule @relation(fields: [tourScheduleId], references: [id])
  discount Discount?    @relation(fields: [discountId], references: [id])

  @@index([userId])
  @@index([tourScheduleId])
  @@map("tour_bookings")
}

// Notification model
model Notification {
  id        Int       @id @default(autoincrement())
  userId    String    @db.VarChar
  type      String    @db.VarChar(50)
  title     String    @db.VarChar(200)
  body      String?   @db.Text
  data      Json?
  isRead    Boolean   @default(false)
  readAt    DateTime?
  createdAt DateTime  @default(now())

  user User @relation(fields: [userId], references: [id])

  @@index([userId, isRead])
  @@map("notifications")
}

// Affiliate marketing models
model Affiliate {
  id               Int      @id @default(autoincrement())
  userId           String   @unique @db.VarChar
  referralCode     String   @unique @db.VarChar(20)
  commissionRate   Decimal  @default(0.05) @db.Decimal(5, 4)
  totalClicks      Int      @default(0)
  totalConversions Int      @default(0)
  totalCommission  Decimal  @default(0) @db.Decimal(10, 2)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user        User                  @relation(fields: [userId], references: [id])
  clicks      AffiliateClick[]
  conversions AffiliateConversion[]
  payouts     Payout[]

  @@map("affiliates")
}

model AffiliateClick {
  id          Int      @id @default(autoincrement())
  affiliateId Int
  landingPage String?  @db.Text
  referrer    String?  @db.Text
  ipAddress   String?  @db.VarChar(100)
  userAgent   String?  @db.Text
  createdAt   DateTime @default(now())

  affiliate Affiliate @relation(fields: [affiliateId], references: [id])

  @@map("affiliate_clicks")
}

model AffiliateConversion {
  id          Int      @id @default(autoincrement())
  affiliateId Int
  orderId     Int?
  bookingId   Int?
  amount      Decimal  @db.Decimal(10, 2)
  commission  Decimal  @db.Decimal(10, 2)
  status      String   @default("pending") @db.VarChar(20)
  createdAt   DateTime @default(now())

  affiliate Affiliate @relation(fields: [affiliateId], references: [id])

  @@map("affiliate_conversions")
}

model Payout {
  id          Int       @id @default(autoincrement())
  affiliateId Int
  amount      Decimal   @db.Decimal(10, 2)
  currency    String    @default("USD") @db.VarChar(3)
  status      String    @default("pending") @db.VarChar(20)
  requestedAt DateTime  @default(now())
  processedAt DateTime?
  notes       String?   @db.Text

  affiliate Affiliate @relation(fields: [affiliateId], references: [id])

  @@map("payouts")
}

model Discount {
  id            Int       @id @default(autoincrement())
  name          String    @db.VarChar(150)
  description   String?   @db.Text
  discountType  String    @db.VarChar(20)
  value         Decimal   @db.Decimal(10, 2)
  startDate     DateTime
  endDate       DateTime
  isActive      Boolean   @default(true)
  productId     Int?
  propertyId    Int?
  tourId        Int?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  product      Product?     @relation(fields: [productId], references: [id])
  property     Property?    @relation(fields: [propertyId], references: [id])
  tour         TourDetail?  @relation(fields: [tourId], references: [id])
  orders       Order[]
  bookings     Booking[]
  tourBookings TourBooking[]

  @@map("discounts")
}

// Admin-defined form templates and fields for governed data collection
model FormTemplate {
  id          String       @id @db.VarChar
  title       String       @db.VarChar(200)
  entity      String       @db.VarChar(100)
  description String?      @db.Text
  status      String       @default("draft") @db.VarChar(50)
  permissions String[]
  updatedAt   DateTime     @updatedAt

  fields FormField[]

  @@map("form_templates")
}

model FormField {
  id          String   @id @db.VarChar
  templateId  String   @db.VarChar
  name        String   @db.VarChar(100)
  label       String   @db.VarChar(150)
  type        String   @db.VarChar(50)
  required    Boolean  @default(false)
  description String?  @db.Text
  validations String[]
  roles       String[]

  template FormTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)

  @@map("form_fields")
}

// Shipping Address model for user delivery addresses
model ShippingAddress {
  id           Int      @id @default(autoincrement())
  userId       String   @db.VarChar
  fullName     String   @db.VarChar(200)
  phoneNumber  String   @db.VarChar(20)
  addressLine1 String   @db.VarChar(255)
  addressLine2 String?  @db.VarChar(255)
  city         String   @db.VarChar(100)
  state        String?  @db.VarChar(100)
  country      String   @db.VarChar(100)
  postalCode   String   @db.VarChar(20)
  isDefault    Boolean  @default(false)
  label        String?  @db.VarChar(50) // e.g., "Home", "Work", "Office"
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("shipping_addresses")
}

// User Phone model for managing multiple phone numbers
model UserPhone {
  id          Int      @id @default(autoincrement())
  userId      String   @db.VarChar
  phoneNumber String   @db.VarChar(20)
  countryCode String   @default("+84") @db.VarChar(5)
  type        String   @default("mobile") @db.VarChar(20) // mobile, home, work
  isVerified  Boolean  @default(false)
  isPrimary   Boolean  @default(false)
  label       String?  @db.VarChar(50)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, phoneNumber])
  @@index([userId])
  @@map("user_phones")
}

// Recently Viewed Products model for tracking user browsing history
model RecentlyViewedProduct {
  id        Int      @id @default(autoincrement())
  userId    String   @db.VarChar
  productId Int
  viewedAt  DateTime @default(now())
  duration  Int?     @default(0) // Duration in seconds
  metadata  Json?    @db.Json // Additional tracking data

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId, viewedAt])
  @@index([productId])
  @@map("recently_viewed_products")
}

// Saved Products model for users to save products for later (different from wishlist)
model SavedProduct {
  id        Int      @id @default(autoincrement())
  userId    String   @db.VarChar
  productId Int
  note      String?  @db.Text // Personal notes about why they saved it
  tags      String[] @db.Text // Custom tags for organization
  savedAt   DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@index([userId])
  @@index([productId])
  @@map("saved_products")
}

// Credit transactions for wallet history
model CreditTransaction {
  id            Int      @id @default(autoincrement())
  userId        String   @db.VarChar
  amount        Int
  balanceAfter  Int
  type          String   @db.VarChar(50)
  description   String?  @db.Text
  referenceType String?  @db.VarChar(50)
  referenceId   String?  @db.VarChar(100)
  createdAt     DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@map("credit_transactions")
}
